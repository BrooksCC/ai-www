"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[127],{285:(e,t,r)=>{r.d(t,{$:()=>n});var a=r(5155),o=r(2115),c=r(9708),s=r(2085),l=r(9434);let i=(0,s.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-[var(--bg-secondary)] border border-[var(--border-color)] hover:bg-[var(--bg-tertiary)]",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive",outline:"bg-[var(--bg-secondary)] border border-[var(--border-color)] hover:bg-[var(--bg-tertiary)]",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),n=o.forwardRef((e,t)=>{let{className:r,variant:o,size:s,asChild:n=!1,...d}=e,h=n?c.DX:"button";return(0,a.jsx)(h,{className:(0,l.cn)(i({variant:o,size:s,className:r})),ref:t,...d})});n.displayName="Button"},1394:(e,t,r)=>{r.d(t,{BK:()=>n,bg:()=>i,eu:()=>l,q5:()=>d,xK:()=>h});var a=r(5155),o=r(2115),c=r(4011),s=r(9434);let l=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)(c.bL,{ref:t,className:(0,s.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...o})});l.displayName=c.bL.displayName;let i=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)(c.bL,{ref:t,className:(0,s.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-lg",r),...o})});i.displayName="SquareAvatar";let n=o.forwardRef((e,t)=>{let{className:r,shouldBlur:o,...l}=e;return(0,a.jsx)(c._V,{ref:t,className:(0,s.cn)("aspect-square h-full w-full",o&&"blur-md",r),...l})});n.displayName=c._V.displayName;let d=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)(c.H4,{ref:t,className:(0,s.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",r),...o})});d.displayName=c.H4.displayName;let h=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)(c.H4,{ref:t,className:(0,s.cn)("flex h-full w-full items-center justify-center rounded-lg bg-muted",r),...o})});h.displayName="SquareAvatarFallback"},2732:(e,t,r)=>{r.d(t,{g:()=>c});var a=r(5155),o=r(2115);function c(e){let{password:t,onValidationChange:r}=e,[c,s]=(0,o.useState)({length:!1,uppercase:!1,lowercase:!1});return(0,o.useEffect)(()=>{let e={length:(t||"").length>=6,uppercase:/[A-Z]/.test(t||""),lowercase:/[a-z]/.test(t||"")};s(e),r&&r(e.length&&e.uppercase&&e.lowercase)},[t,r]),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("p",{className:"text-xs text-[var(--text-secondary)] mb-1",children:"密码必须满足："}),(0,a.jsxs)("ul",{className:"text-xs space-y-1",children:[(0,a.jsxs)("li",{className:"flex items-center ".concat(c.length?"text-green-500":"text-[var(--text-secondary)]"),children:[(0,a.jsx)("span",{children:c.length?"✓":"○"}),(0,a.jsx)("span",{className:"ml-1",children:"至少6个字符"})]}),(0,a.jsxs)("li",{className:"flex items-center ".concat(c.uppercase?"text-green-500":"text-[var(--text-secondary)]"),children:[(0,a.jsx)("span",{children:c.uppercase?"✓":"○"}),(0,a.jsx)("span",{className:"ml-1",children:"至少1个大写字母"})]}),(0,a.jsxs)("li",{className:"flex items-center ".concat(c.lowercase?"text-green-500":"text-[var(--text-secondary)]"),children:[(0,a.jsx)("span",{children:c.lowercase?"✓":"○"}),(0,a.jsx)("span",{className:"ml-1",children:"至少1个小写字母"})]})]})]})}},2847:(e,t,r)=>{r.d(t,{Ib:()=>i,MM:()=>n,Q$:()=>d});var a=r(2115),o=r(2045),c=r(6305),s=r(3525),l=r(3832);let i=()=>{let e=(0,o.G)(c.xk),t=(0,o.G)(c.QB),r=(0,o.G)(c.Im),a=(0,o.G)(c.yw),s=(0,o.G)(c.ov),l=(0,o.G)(c.Vs),i=(0,o.G)(c.TG),n=(0,o.G)(e=>e.character.categories),d={totalCount:s,currentPage:l,totalPages:i,limit:a.limit};return{characters:e,isLoading:t,error:r,filters:a,pagination:d,categories:n}},n=()=>{let e=(0,o.j)();(0,o.G)(c.yw);let t=(0,a.useCallback)(t=>(t&&e((0,s._F)(t)),e((0,l.Cb)())),[e]),r=(0,a.useCallback)(t=>e((0,l.UG)(t)),[e]),i=(0,a.useCallback)(t=>e((0,l.kN)(t)),[e]),n=(0,a.useCallback)((t,r)=>e((0,l.xi)({id:t,updateData:r})),[e]),d=(0,a.useCallback)(t=>e((0,l.jQ)(t)),[e]),h=(0,a.useCallback)(t=>e((0,l.T8)(t)),[e]),u=(0,a.useCallback)(()=>{e((0,s.ET)())},[e]);return{searchCharacters:t,fetchCharacterById:r,createCharacter:i,updateCharacter:n,deleteCharacter:d,toggleFavorite:h,clearErrors:u,setFilter:(0,a.useCallback)(t=>{e((0,s._F)(t))},[e]),fetchCategories:(0,a.useCallback)(()=>e((0,l.zN)()),[e])}},d=()=>{let e=(0,o.j)(),[t,r]=(0,a.useState)([]),[c,s]=(0,a.useState)(!1),[i,n]=(0,a.useState)(null),[d,h]=(0,a.useState)({currentPage:1,totalPages:1,totalCount:0,limit:10}),u=(0,a.useCallback)(async function(t,a){arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.limit,s(!0),n(null);try{let a=await e((0,l.XM)({userId:t}));if(l.XM.fulfilled.match(a)){let e=a.payload;r(e.items),h({currentPage:e.page,totalPages:Math.ceil(e.total/e.limit),totalCount:e.total,limit:e.limit})}else l.XM.rejected.match(a)&&n(a.error.message||"Failed to fetch favorites")}catch(e){e instanceof Error?n(e.message||"An unexpected error occurred"):n("An unexpected error occurred")}s(!1)},[e,d.limit]),f=(0,a.useCallback)(async(t,r,a)=>{try{let o=await e((0,l.T8)(t));l.T8.fulfilled.match(o)&&r&&a&&setTimeout(()=>u(r,a,d.limit),300)}catch(e){console.error("Error toggling favorite and refreshing list:",e)}},[e,u,d.limit]);return{favoriteCharacters:t,isLoading:c,error:i,pagination:d,fetchFavorites:u,toggleFavoriteAndRefresh:f}}},3525:(e,t,r)=>{r.d(t,{Ay:()=>v,ET:()=>m,Nh:()=>f,_F:()=>h,dw:()=>d,jO:()=>n,r1:()=>u,zw:()=>y});var a=r(6439),o=r(4421),c=r(3832);let s={search:"",sortBy:o.Qi.createdAt,tags:[],page:1,limit:20,visibility:o.HQ.public,status:o.h4.published},l=(0,a.Z0)({name:"character",initialState:{characters:[],currentCharacter:null,isLoading:!1,error:null,totalCount:0,currentPage:1,totalPages:1,filters:s,categories:[]},reducers:{setCharacters:(e,t)=>{e.characters=t.payload},setCurrentCharacter:(e,t)=>{e.currentCharacter=t.payload},toggleFavorite:(e,t)=>{var r,a,o,c,s;let l=t.payload;(null==(r=e.currentCharacter)?void 0:r.id)===l&&(e.currentCharacter.isFavorited=!e.currentCharacter.isFavorited,e.currentCharacter.isFavorited?e.currentCharacter.favoriteCount=(null!=(a=e.currentCharacter.favoriteCount)?a:0)+1:e.currentCharacter.favoriteCount=Math.max(0,(null!=(o=e.currentCharacter.favoriteCount)?o:1)-1));let i=e.characters.findIndex(e=>e.id===l);if(-1!==i){let t=e.characters[i],r="boolean"==typeof t.isFavorited&&t.isFavorited;t.isFavorited=!r,t.isFavorited?t.favoriteCount=(null!=(c=t.favoriteCount)?c:0)+1:t.favoriteCount=Math.max(0,(null!=(s=t.favoriteCount)?s:1)-1)}},setFilters:(e,t)=>{e.filters={...e.filters,...t.payload},("search"in t.payload||"tags"in t.payload)&&(e.filters.page=1)},setLoading:(e,t)=>{e.isLoading=t.payload},setError:(e,t)=>{e.error=t.payload},setPagination:(e,t)=>{e.totalCount=t.payload.totalCount,e.currentPage=t.payload.currentPage,e.totalPages=t.payload.totalPages},clearError:e=>{e.error=null},setCategories:(e,t)=>{e.categories=t.payload}},extraReducers:e=>{e.addCase(c.Cb.pending,e=>{e.isLoading=!0,e.error=null}).addCase(c.Cb.fulfilled,(e,t)=>{e.isLoading=!1,e.characters=t.payload.characters,e.totalCount=t.payload.totalCount,e.totalPages=t.payload.totalPages,e.currentPage=t.payload.currentPage}).addCase(c.Cb.rejected,(e,t)=>{e.isLoading=!1,e.error=t.error.message||"Failed to fetch characters"}).addCase(c.UG.pending,e=>{e.isLoading=!0,e.error=null}).addCase(c.UG.fulfilled,(e,t)=>{if(e.isLoading=!1,t.payload&&"object"==typeof t.payload&&t.payload.id){e.currentCharacter=t.payload;let r=e.characters.findIndex(e=>e.id===t.payload.id);-1!==r&&e.characters[r]&&(e.characters[r]={...e.characters[r],...t.payload})}else e.currentCharacter=null}).addCase(c.UG.rejected,(e,t)=>{e.isLoading=!1,e.error=t.error.message||"Failed to fetch character details",e.currentCharacter=null}).addCase(c.T8.fulfilled,(e,t)=>{var r;let{characterId:a,isFavorited:o}=t.payload;(null==(r=e.currentCharacter)?void 0:r.id)===a&&(e.currentCharacter.isFavorited=o);let c=e.characters.findIndex(e=>e.id===a);-1!==c&&(e.characters[c].isFavorited=o)}).addCase(c.T8.rejected,(e,t)=>{console.error("Failed to toggle favorite:",t.error.message),e.error=t.error.message||"Failed to update favorite status"})}}),{setCharacters:i,setCurrentCharacter:n,toggleFavorite:d,setFilters:h,setLoading:u,setError:f,setPagination:g,clearError:m,setCategories:y}=l.actions,v=l.reducer},3832:(e,t,r)=>{r.d(t,{Cb:()=>s,T8:()=>i,UG:()=>l,XM:()=>u,jQ:()=>h,kN:()=>n,xi:()=>d,zN:()=>f});var a=r(6439),o=r(3525),c=r(4087);let s=(0,a.zD)("character/searchCharacters",async(e,t)=>{let{dispatch:r,getState:a}=t;try{r((0,o.r1)(!0));let{filters:e}=a().character;console.log("filters",JSON.stringify(e));let t=e.page||1,s=e.limit||20,{...l}=e,i=await c.j.searchCharacters(t,s,l);if(i){let e=Math.ceil(i.total/(i.limit||s));return{characters:i.items||[],totalCount:i.total||0,currentPage:i.page||1,totalPages:e||1}}throw r((0,o.Nh)("failed to fetch characters")),Error("Failed to fetch characters")}catch(t){let e=t instanceof Error?t.message:String(t);throw r((0,o.Nh)(e)),console.error("Failed to fetch characters:",t),t}finally{r((0,o.r1)(!1))}}),l=(0,a.zD)("character/fetchCharacterById",async(e,t)=>{let{dispatch:r,getState:a}=t;try{r((0,o.r1)(!0));let t=await c.j.getCharacterDetail(e);if(t)return t;return void console.warn("Character not found with ID ".concat(e))}catch(t){throw t instanceof Error?t.message:String(t),console.error("Failed to fetch character with ID ".concat(e,":"),t),t}finally{r((0,o.r1)(!1))}}),i=(0,a.zD)("character/toggleFavorite",async(e,t)=>{let{dispatch:r,getState:a}=t,{currentCharacter:s}=a().character,l=!1;s&&s.id===e&&(l=!!s.isFavorited);try{return l?await c.j.removeFavorite(e):await c.j.favoriteCharacter(e),r((0,o.dw)(e)),{characterId:e,isFavorited:!l}}catch(a){let t=a instanceof Error?a.message:String(a);throw r((0,o.Nh)(t)),r((0,o.dw)(e)),console.error("Failed to toggle favorite status:",a),a}}),n=(0,a.zD)("character/createCharacter",async(e,t)=>{let{dispatch:r}=t;try{r((0,o.r1)(!0));let t=await c.j.create(e);return r(s()),t}catch(t){let e=t instanceof Error?t.message:String(t);throw r((0,o.Nh)(e)),console.error("Failed to create character:",t),t}finally{r((0,o.r1)(!1))}}),d=(0,a.zD)("character/updateCharacter",async(e,t)=>{let{id:r,updateData:a}=e,{dispatch:s}=t;try{s((0,o.r1)(!0)),await c.j.update(r,a);let e=await c.j.getCharacterDetail(r);if(!e)throw Error("Failed to fetch updated character details after update.");return s((0,o.jO)(e)),e}catch(t){let e=t instanceof Error?t.message:String(t);throw s((0,o.Nh)(e)),console.error("Failed to update character:",t),t}finally{s((0,o.r1)(!1))}}),h=(0,a.zD)("character/deleteCharacter",async(e,t)=>{let{dispatch:r}=t;try{r((0,o.r1)(!0)),r(s())}catch(t){let e=t instanceof Error?t.message:String(t);r((0,o.Nh)(e)),console.error("Failed to delete character:",t)}finally{r((0,o.r1)(!1))}}),u=(0,a.zD)("character/fetchUserFavorites",async(e,t)=>{let{userId:r}=e,{dispatch:a,getState:o}=t;try{let e=await c.j.findUserFavorites(r,1,100);if(e)return e;throw Error("Failed to fetch user favorites")}catch(e){throw e instanceof Error?e.message:String(e),console.error("Failed to fetch user favorites:",e),e}finally{}}),f=(0,a.zD)("character/fetchCategories",async(e,t)=>{let{dispatch:r}=t;try{r((0,o.r1)(!0));let e=await c.j.getAllCategoriesWithPopularTags();return r((0,o.zw)(e.categories)),e}catch(t){let e=t instanceof Error?t.message:String(t);throw r((0,o.Nh)(e)),console.error("Failed to fetch categories and tags:",t),t}finally{r((0,o.r1)(!1))}})},4087:(e,t,r)=>{r.d(t,{j:()=>l});var a=r(9249),o=r(6168),c=r(3299);class s{async create(e){try{return(await o.o.characters.create({createCharacterRequestDto:e})).data}catch(e){throw console.error("Failed to create character:",e),e}}async favoriteCharacter(e){try{await o.o.characters.favoriteCharacter({id:e})}catch(e){throw console.error("Failed to favorite character:",e),e}}async removeFavorite(e){try{await o.o.characters.unfavoriteCharacter({id:e})}catch(e){throw console.error("Failed to remove favorite character:",e),e}}async findUserFavorites(e,t,r){try{return(await o.o.characters.findUserFavorites({userId:e,page:t,limit:r})).data}catch(e){throw console.error("Failed to find user favorites:",e),e}}async getAllCategoriesWithPopularTags(){try{return(await o.o.characters.getAllCategoriesWithPopularTags()).data}catch(e){throw console.error("Failed to get all categories with popular tags:",e),e}}async getCharacterDetail(e){try{return(await o.o.characters.getCharacterDetail({id:e})).data}catch(e){throw console.error("Failed to get character detail:",e),e}}async getRatings(e,t,r){try{return(await o.o.characters.getRatings({id:e,page:t,limit:r})).data}catch(e){throw console.error("Failed to get ratings:",e),e}}async importCharacter(e,t){try{return(await o.o.characters.importCharacter({format:e,preservedFileName:t})).data}catch(e){throw console.error("Failed to import character:",e),e}}async rateCharacter(e,t){try{return(await o.o.characters.rateCharacter({id:e,rateCharacterRequestDto:t})).data}catch(e){throw console.error("Failed to rate character:",e),e}}async remove(e){try{await o.o.characters.remove({id:e})}catch(e){throw console.error("Failed to remove character:",e),e}}async searchCharacters(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{return(await o.o.characters.searchCharacters({page:e,limit:t,...r})).data}catch(e){throw console.error("Failed to search characters:",e),e}}async unfavoriteCharacter(e){try{await o.o.characters.unfavoriteCharacter({id:e})}catch(e){throw console.error("Failed to unfavorite character:",e),e}}async update(e,t){try{return(await o.o.characters.update({id:e,updateCharacterRequestDto:t})).data}catch(e){throw console.error("Failed to update character:",e),e}}}let l=new(s=(0,a.Cg)([c.A.Singleton],s))},6305:(e,t,r)=>{r.d(t,{Im:()=>s,QB:()=>c,TB:()=>o,TG:()=>n,Vs:()=>i,ov:()=>l,xk:()=>a,yw:()=>d});let a=e=>e.character.characters,o=e=>e.character.currentCharacter,c=e=>e.character.isLoading,s=e=>e.character.error,l=e=>e.character.totalCount,i=e=>e.character.currentPage,n=e=>e.character.totalPages,d=e=>e.character.filters},7280:(e,t,r)=>{r.d(t,{D:()=>c.D,ThemeProvider:()=>i});var a=r(5155),o=r(2115),c=r(1362),s=r(8613);let l=["dark","light","pink","system"];function i(e){let{children:t}=e,{themeSetting:r,updateSettings:o}=(0,s.Qg)();return(0,a.jsx)(c.N,{attribute:"class",defaultTheme:"dark",enableSystem:!1,themes:l,children:(0,a.jsx)(n,{initialThemeSetting:r,updateSettings:o,children:t})})}function n(e){let{initialThemeSetting:t,updateSettings:r,children:s}=e,{setTheme:i,theme:n,resolvedTheme:d}=(0,c.D)(),[h,u]=(0,o.useState)(!1),[f,g]=(0,o.useState)(t);return((0,o.useEffect)(()=>{u(!0)},[]),(0,o.useEffect)(()=>{if(h&&t&&t!==d){let e=t;l.includes(e)||(console.warn('[ThemeProvider] Invalid initial theme "'.concat(e,'" from Redux, defaulting to dark.')),e="dark"),console.log("[ThemeProvider] Initial sync Redux (".concat(e,") -> next-themes.")),i(e)}},[h,t,d,i]),(0,o.useEffect)(()=>{h&&d&&d!==f&&l.includes(d)&&(console.log("[ThemeProvider] Sync next-themes (".concat(d,") -> Redux.")),r({theme:d}).then(e=>{e?g(d):console.error("[ThemeProvider] Failed to sync theme to Redux.")}))},[h,d,f,r,i]),(0,o.useEffect)(()=>{h&&t!==f&&(console.log("[ThemeProvider] Redux state changed externally to: ".concat(t,". Updating tracker.")),g(t))},[h,t,f,d,i]),(0,o.useEffect)(()=>{h&&console.log("[ThemeProvider] Current theme state:",{reduxTheme:f,nextThemesTheme:n,nextThemesResolved:d,bodyClass:document.body.className})},[h,f,n,d]),h)?(0,a.jsx)(a.Fragment,{children:s}):(0,a.jsx)("div",{style:{visibility:"hidden"},children:s})}},7374:(e,t,r)=>{r.d(t,{J1:()=>i,lJ:()=>l,oR:()=>s});var a=r(4752),o=r.n(a);let c=()=>({background:"var(--bg-secondary)",color:"var(--text-primary)",confirmButtonColor:"var(--switch-checked-bg)",cancelButtonColor:"var(--switch-unchecked-bg)"}),s={success:e=>{o().fire({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:"success",title:e,...c()})},error:e=>{o().fire({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:"error",title:e,...c()})},loading:e=>{o().fire({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:"info",title:e,...c()})},promise:(e,t)=>o().fire({title:t.loading,allowOutsideClick:!1,showConfirmButton:!1,...c()}).then(()=>e.then(()=>{o().fire({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:"success",title:t.success,...c()})}).catch(()=>{o().fire({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:"error",title:t.error,...c()})}))},l=e=>o().fire({title:e.title,text:e.text,showCancelButton:!0,confirmButtonText:e.confirmButtonText||"确认",cancelButtonText:e.cancelButtonText||"取消",...c()}),i=e=>o().fire({title:e.title,text:e.text,input:e.input||"text",inputValue:e.inputValue,inputPlaceholder:e.inputPlaceholder,showCancelButton:!0,confirmButtonText:e.confirmButtonText||"确认",cancelButtonText:e.cancelButtonText||"取消",...c()})},9434:(e,t,r)=>{r.d(t,{cn:()=>c});var a=r(2596),o=r(9688);function c(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,o.QP)((0,a.$)(t))}}}]);