"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[118],{285:(e,r,t)=>{t.d(r,{$:()=>n});var a=t(5155),o=t(2115),c=t(9708),s=t(2085),l=t(9434);let i=(0,s.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-[var(--bg-secondary)] border border-[var(--border-color)] hover:bg-[var(--bg-tertiary)]",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive",outline:"bg-[var(--bg-secondary)] border border-[var(--border-color)] hover:bg-[var(--bg-tertiary)]",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),n=o.forwardRef((e,r)=>{let{className:t,variant:o,size:s,asChild:n=!1,...d}=e,h=n?c.DX:"button";return(0,a.jsx)(h,{className:(0,l.cn)(i({variant:o,size:s,className:t})),ref:r,...d})});n.displayName="Button"},1394:(e,r,t)=>{t.d(r,{BK:()=>n,bg:()=>i,eu:()=>l,q5:()=>d,xK:()=>h});var a=t(5155),o=t(2115),c=t(4011),s=t(9434);let l=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,a.jsx)(c.bL,{ref:r,className:(0,s.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...o})});l.displayName=c.bL.displayName;let i=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,a.jsx)(c.bL,{ref:r,className:(0,s.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-lg",t),...o})});i.displayName="SquareAvatar";let n=o.forwardRef((e,r)=>{let{className:t,shouldBlur:o,...l}=e;return(0,a.jsx)(c._V,{ref:r,className:(0,s.cn)("aspect-square h-full w-full",o&&"blur-md",t),...l})});n.displayName=c._V.displayName;let d=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,a.jsx)(c.H4,{ref:r,className:(0,s.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...o})});d.displayName=c.H4.displayName;let h=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,a.jsx)(c.H4,{ref:r,className:(0,s.cn)("flex h-full w-full items-center justify-center rounded-lg bg-muted",t),...o})});h.displayName="SquareAvatarFallback"},2732:(e,r,t)=>{t.d(r,{g:()=>c});var a=t(5155),o=t(2115);function c(e){let{password:r,onValidationChange:t}=e,[c,s]=(0,o.useState)({length:!1,uppercase:!1,lowercase:!1});return(0,o.useEffect)(()=>{let e={length:(r||"").length>=6,uppercase:/[A-Z]/.test(r||""),lowercase:/[a-z]/.test(r||"")};s(e),t&&t(e.length&&e.uppercase&&e.lowercase)},[r,t]),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("p",{className:"text-xs text-[var(--text-secondary)] mb-1",children:"密码必须满足："}),(0,a.jsxs)("ul",{className:"text-xs space-y-1",children:[(0,a.jsxs)("li",{className:"flex items-center ".concat(c.length?"text-green-500":"text-[var(--text-secondary)]"),children:[(0,a.jsx)("span",{children:c.length?"✓":"○"}),(0,a.jsx)("span",{className:"ml-1",children:"至少6个字符"})]}),(0,a.jsxs)("li",{className:"flex items-center ".concat(c.uppercase?"text-green-500":"text-[var(--text-secondary)]"),children:[(0,a.jsx)("span",{children:c.uppercase?"✓":"○"}),(0,a.jsx)("span",{className:"ml-1",children:"至少1个大写字母"})]}),(0,a.jsxs)("li",{className:"flex items-center ".concat(c.lowercase?"text-green-500":"text-[var(--text-secondary)]"),children:[(0,a.jsx)("span",{children:c.lowercase?"✓":"○"}),(0,a.jsx)("span",{className:"ml-1",children:"至少1个小写字母"})]})]})]})}},2847:(e,r,t)=>{t.d(r,{Ib:()=>i,MM:()=>d,OE:()=>n,Q$:()=>h});var a=t(2115),o=t(2045),c=t(6305),s=t(3525),l=t(5055);let i=()=>{let e=(0,o.G)(c.xk),r=(0,o.G)(c.QB),t=(0,o.G)(c.Im),a=(0,o.G)(c.yw),s=(0,o.G)(c.ov),l=(0,o.G)(c.Vs),i=(0,o.G)(c.TG),n=(0,o.G)(e=>e.character.categories),d={totalCount:s,currentPage:l,totalPages:i,limit:a.limit};return{characters:e,isLoading:r,error:t,filters:a,pagination:d,categories:n}},n=()=>{let e=(0,o.G)(c.TB);return{currentCharacter:e,isLoading:(0,o.G)(c.QB),error:(0,o.G)(c.Im)}},d=()=>{let e=(0,o.j)();(0,o.G)(c.yw);let r=(0,a.useCallback)(r=>(r&&e((0,s._F)(r)),e((0,l.Cb)())),[e]),t=(0,a.useCallback)(r=>e((0,l.UG)(r)),[e]),i=(0,a.useCallback)(r=>e((0,l.kN)(r)),[e]),n=(0,a.useCallback)((r,t)=>e((0,l.xi)({id:r,updateData:t})),[e]),d=(0,a.useCallback)(r=>e((0,l.jQ)(r)),[e]),h=(0,a.useCallback)(r=>e((0,l.T8)(r)),[e]),u=(0,a.useCallback)(()=>{e((0,s.ET)())},[e]);return{searchCharacters:r,fetchCharacterById:t,createCharacter:i,updateCharacter:n,deleteCharacter:d,toggleFavorite:h,clearErrors:u,setFilter:(0,a.useCallback)(r=>{e((0,s._F)(r))},[e]),fetchCategories:(0,a.useCallback)(()=>e((0,l.zN)()),[e])}},h=()=>{let e=(0,o.j)(),[r,t]=(0,a.useState)([]),[c,s]=(0,a.useState)(!1),[i,n]=(0,a.useState)(null),[d,h]=(0,a.useState)({currentPage:1,totalPages:1,totalCount:0,limit:10}),u=(0,a.useCallback)(async function(r,a){arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.limit,s(!0),n(null);try{let a=await e((0,l.XM)({userId:r}));if(l.XM.fulfilled.match(a)){let e=a.payload;t(e.items),h({currentPage:e.page,totalPages:Math.ceil(e.total/e.limit),totalCount:e.total,limit:e.limit})}else l.XM.rejected.match(a)&&n(a.error.message||"Failed to fetch favorites")}catch(e){e instanceof Error?n(e.message||"An unexpected error occurred"):n("An unexpected error occurred")}s(!1)},[e,d.limit]),f=(0,a.useCallback)(async(r,t,a)=>{try{let o=await e((0,l.T8)(r));l.T8.fulfilled.match(o)&&t&&a&&setTimeout(()=>u(t,a,d.limit),300)}catch(e){console.error("Error toggling favorite and refreshing list:",e)}},[e,u,d.limit]);return{favoriteCharacters:r,isLoading:c,error:i,pagination:d,fetchFavorites:u,toggleFavoriteAndRefresh:f}}},3525:(e,r,t)=>{t.d(r,{Ay:()=>v,ET:()=>m,Nh:()=>f,_F:()=>h,dw:()=>d,jO:()=>n,r1:()=>u,zw:()=>y});var a=t(6439),o=t(4421),c=t(5055);let s={search:"",categoryId:"",sortBy:o.Qi.createdAt,tags:[],page:1,limit:20,visibility:o.HQ.public,status:o.h4.published},l=(0,a.Z0)({name:"character",initialState:{characters:[],currentCharacter:null,isLoading:!1,error:null,totalCount:0,currentPage:1,totalPages:1,filters:s,categories:[]},reducers:{setCharacters:(e,r)=>{e.characters=r.payload},setCurrentCharacter:(e,r)=>{e.currentCharacter=r.payload},toggleFavorite:(e,r)=>{var t,a,o,c,s;let l=r.payload;(null==(t=e.currentCharacter)?void 0:t.id)===l&&(e.currentCharacter.isFavorited=!e.currentCharacter.isFavorited,e.currentCharacter.isFavorited?e.currentCharacter.favoriteCount=(null!=(a=e.currentCharacter.favoriteCount)?a:0)+1:e.currentCharacter.favoriteCount=Math.max(0,(null!=(o=e.currentCharacter.favoriteCount)?o:1)-1));let i=e.characters.findIndex(e=>e.id===l);if(-1!==i){let r=e.characters[i],t="boolean"==typeof r.isFavorited&&r.isFavorited;r.isFavorited=!t,r.isFavorited?r.favoriteCount=(null!=(c=r.favoriteCount)?c:0)+1:r.favoriteCount=Math.max(0,(null!=(s=r.favoriteCount)?s:1)-1)}},setFilters:(e,r)=>{e.filters={...e.filters,...r.payload},("search"in r.payload||"categoryId"in r.payload||"tags"in r.payload)&&(e.filters.page=1)},setLoading:(e,r)=>{e.isLoading=r.payload},setError:(e,r)=>{e.error=r.payload},setPagination:(e,r)=>{e.totalCount=r.payload.totalCount,e.currentPage=r.payload.currentPage,e.totalPages=r.payload.totalPages},clearError:e=>{e.error=null},setCategories:(e,r)=>{e.categories=r.payload}},extraReducers:e=>{e.addCase(c.Cb.pending,e=>{e.isLoading=!0,e.error=null}).addCase(c.Cb.fulfilled,(e,r)=>{e.isLoading=!1,e.characters=r.payload.characters,e.totalCount=r.payload.totalCount,e.totalPages=r.payload.totalPages,e.currentPage=r.payload.currentPage}).addCase(c.Cb.rejected,(e,r)=>{e.isLoading=!1,e.error=r.error.message||"Failed to fetch characters"}).addCase(c.UG.pending,e=>{e.isLoading=!0,e.error=null}).addCase(c.UG.fulfilled,(e,r)=>{if(e.isLoading=!1,r.payload&&"object"==typeof r.payload&&r.payload.id){e.currentCharacter=r.payload;let t=e.characters.findIndex(e=>e.id===r.payload.id);-1!==t&&e.characters[t]&&(e.characters[t]={...e.characters[t],...r.payload})}else e.currentCharacter=null}).addCase(c.UG.rejected,(e,r)=>{e.isLoading=!1,e.error=r.error.message||"Failed to fetch character details",e.currentCharacter=null}).addCase(c.T8.fulfilled,(e,r)=>{var t;let{characterId:a,isFavorited:o}=r.payload;(null==(t=e.currentCharacter)?void 0:t.id)===a&&(e.currentCharacter.isFavorited=o);let c=e.characters.findIndex(e=>e.id===a);-1!==c&&(e.characters[c].isFavorited=o)}).addCase(c.T8.rejected,(e,r)=>{console.error("Failed to toggle favorite:",r.error.message),e.error=r.error.message||"Failed to update favorite status"})}}),{setCharacters:i,setCurrentCharacter:n,toggleFavorite:d,setFilters:h,setLoading:u,setError:f,setPagination:g,clearError:m,setCategories:y}=l.actions,v=l.reducer},5055:(e,r,t)=>{t.d(r,{kN:()=>f,jQ:()=>m,zN:()=>v,UG:()=>h,XM:()=>y,Cb:()=>d,T8:()=>u,xi:()=>g});var a=t(6439),o=t(3525),c=t(9249),s=t(6168),l=t(3299);class i{async create(e){try{return(await s.o.characters.create({createCharacterRequestDto:e})).data}catch(e){throw console.error("Failed to create character:",e),e}}async favoriteCharacter(e){try{await s.o.characters.favoriteCharacter({id:e})}catch(e){throw console.error("Failed to favorite character:",e),e}}async removeFavorite(e){try{await s.o.characters.unfavoriteCharacter({id:e})}catch(e){throw console.error("Failed to remove favorite character:",e),e}}async findUserFavorites(e,r,t){try{return(await s.o.characters.findUserFavorites({userId:e,page:r,limit:t})).data}catch(e){throw console.error("Failed to find user favorites:",e),e}}async getAllCategoriesWithPopularTags(){try{return(await s.o.characters.getAllCategoriesWithPopularTags()).data}catch(e){throw console.error("Failed to get all categories with popular tags:",e),e}}async getCharacterDetail(e){try{return(await s.o.characters.getCharacterDetail({id:e})).data}catch(e){throw console.error("Failed to get character detail:",e),e}}async getRatings(e,r,t){try{return(await s.o.characters.getRatings({id:e,page:r,limit:t})).data}catch(e){throw console.error("Failed to get ratings:",e),e}}async importCharacter(e,r){try{return(await s.o.characters.importCharacter({format:e,preservedFileName:r})).data}catch(e){throw console.error("Failed to import character:",e),e}}async rateCharacter(e,r){try{return(await s.o.characters.rateCharacter({id:e,rateCharacterRequestDto:r})).data}catch(e){throw console.error("Failed to rate character:",e),e}}async remove(e){try{await s.o.characters.remove({id:e})}catch(e){throw console.error("Failed to remove character:",e),e}}async searchCharacters(e,r){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{return(await s.o.characters.searchCharacters({page:e,limit:r,...t})).data}catch(e){throw console.error("Failed to search characters:",e),e}}async unfavoriteCharacter(e){try{await s.o.characters.unfavoriteCharacter({id:e})}catch(e){throw console.error("Failed to unfavorite character:",e),e}}async update(e,r){try{return(await s.o.characters.update({id:e,updateCharacterRequestDto:r})).data}catch(e){throw console.error("Failed to update character:",e),e}}}let n=new(i=(0,c.Cg)([l.A.Singleton],i)),d=(0,a.zD)("character/searchCharacters",async(e,r)=>{let{dispatch:t,getState:a}=r;try{t((0,o.r1)(!0));let{filters:e}=a().character;console.log("filters",JSON.stringify(e));let r=e.page||1,c=e.limit||20,{...s}=e,l=await n.searchCharacters(r,c,s);if(console.log("result",JSON.stringify(l)),l){let e=Math.ceil(l.total/(l.limit||c));return{characters:l.items||[],totalCount:l.total||0,currentPage:l.page||1,totalPages:e||1}}throw t((0,o.Nh)("failed to fetch characters")),Error("Failed to fetch characters")}catch(r){let e=r instanceof Error?r.message:String(r);throw t((0,o.Nh)(e)),console.error("Failed to fetch characters:",r),r}finally{t((0,o.r1)(!1))}}),h=(0,a.zD)("character/fetchCharacterById",async(e,r)=>{let{dispatch:t,getState:a}=r;try{t((0,o.r1)(!0));let r=await n.getCharacterDetail(e);if(r)return r;return void console.warn("Character not found with ID ".concat(e))}catch(r){throw r instanceof Error?r.message:String(r),console.error("Failed to fetch character with ID ".concat(e,":"),r),r}finally{t((0,o.r1)(!1))}}),u=(0,a.zD)("character/toggleFavorite",async(e,r)=>{let{dispatch:t,getState:a}=r,{currentCharacter:c}=a().character,s=!1;c&&c.id===e&&(s=!!c.isFavorited);try{return s?await n.removeFavorite(e):await n.favoriteCharacter(e),t((0,o.dw)(e)),{characterId:e,isFavorited:!s}}catch(a){let r=a instanceof Error?a.message:String(a);throw t((0,o.Nh)(r)),t((0,o.dw)(e)),console.error("Failed to toggle favorite status:",a),a}}),f=(0,a.zD)("character/createCharacter",async(e,r)=>{let{dispatch:t}=r;try{t((0,o.r1)(!0));let r=await n.create(e);return t(d()),r}catch(r){let e=r instanceof Error?r.message:String(r);throw t((0,o.Nh)(e)),console.error("Failed to create character:",r),r}finally{t((0,o.r1)(!1))}}),g=(0,a.zD)("character/updateCharacter",async(e,r)=>{let{id:t,updateData:a}=e,{dispatch:c}=r;try{c((0,o.r1)(!0)),await n.update(t,a);let e=await n.getCharacterDetail(t);if(!e)throw Error("Failed to fetch updated character details after update.");return c((0,o.jO)(e)),e}catch(r){let e=r instanceof Error?r.message:String(r);throw c((0,o.Nh)(e)),console.error("Failed to update character:",r),r}finally{c((0,o.r1)(!1))}}),m=(0,a.zD)("character/deleteCharacter",async(e,r)=>{let{dispatch:t}=r;try{t((0,o.r1)(!0)),t(d())}catch(r){let e=r instanceof Error?r.message:String(r);t((0,o.Nh)(e)),console.error("Failed to delete character:",r)}finally{t((0,o.r1)(!1))}}),y=(0,a.zD)("character/fetchUserFavorites",async(e,r)=>{let{userId:t}=e,{dispatch:a,getState:o}=r;try{let e=await n.findUserFavorites(t,1,100);if(e)return e;throw Error("Failed to fetch user favorites")}catch(e){throw e instanceof Error?e.message:String(e),console.error("Failed to fetch user favorites:",e),e}finally{}}),v=(0,a.zD)("character/fetchCategories",async(e,r)=>{let{dispatch:t}=r;try{t((0,o.r1)(!0));let e=await n.getAllCategoriesWithPopularTags();return t((0,o.zw)(e.categories)),e}catch(r){let e=r instanceof Error?r.message:String(r);throw t((0,o.Nh)(e)),console.error("Failed to fetch categories and tags:",r),r}finally{t((0,o.r1)(!1))}})},6305:(e,r,t)=>{t.d(r,{Im:()=>s,QB:()=>c,TB:()=>o,TG:()=>n,Vs:()=>i,ov:()=>l,xk:()=>a,yw:()=>d});let a=e=>e.character.characters,o=e=>e.character.currentCharacter,c=e=>e.character.isLoading,s=e=>e.character.error,l=e=>e.character.totalCount,i=e=>e.character.currentPage,n=e=>e.character.totalPages,d=e=>e.character.filters},7374:(e,r,t)=>{t.d(r,{lJ:()=>l,oR:()=>s});var a=t(4752),o=t.n(a);let c=()=>({background:"var(--bg-secondary)",color:"var(--text-primary)",confirmButtonColor:"var(--switch-checked-bg)",cancelButtonColor:"var(--switch-unchecked-bg)"}),s={success:e=>{o().fire({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:"success",title:e,...c()})},error:e=>{o().fire({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:"error",title:e,...c()})},loading:e=>{o().fire({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:"info",title:e,...c()})},promise:(e,r)=>o().fire({title:r.loading,allowOutsideClick:!1,showConfirmButton:!1,...c()}).then(()=>e.then(()=>{o().fire({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:"success",title:r.success,...c()})}).catch(()=>{o().fire({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:"error",title:r.error,...c()})}))},l=e=>o().fire({title:e.title,text:e.text,showCancelButton:!0,confirmButtonText:e.confirmButtonText||"确认",cancelButtonText:e.cancelButtonText||"取消",...c()})},9434:(e,r,t)=>{t.d(r,{cn:()=>c});var a=t(2596),o=t(9688);function c(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,o.QP)((0,a.$)(r))}}}]);