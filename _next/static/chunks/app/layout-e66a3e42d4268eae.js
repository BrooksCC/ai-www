(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{41:(e,t,r)=>{"use strict";r.d(t,{Mw:()=>a.Mw,po:()=>a.po});var a=r(5939)},229:(e,t,r)=>{"use strict";r.d(t,{AuthGuard:()=>d});var a=r(5155),o=r(2115),s=r(5695),n=r(2045),i=r(1795);let l=["/profile","/chat","/character/dialogue"],d=e=>{let{children:t}=e,r=(0,s.useRouter)(),d=(0,s.usePathname)(),c=(0,n.G)(i.Kc);return(0,o.useEffect)(()=>{l.some(e=>d===e||d.startsWith("".concat(e,"/")))&&!c&&r.replace("/?auth=required")},[c,d,r]),(0,a.jsx)(a.Fragment,{children:t})}},347:()=>{},1002:(e,t,r)=>{"use strict";r.d(t,{default:()=>c});var a=r(5155),o=r(6874),s=r.n(o),n=r(5695),i=r(4540),l=r(3500),d=r(2847);function c(){let e=(0,n.usePathname)(),t=(0,n.useRouter)(),r=(0,i.d4)(e=>e.user.isAuthenticated),{stories:o}=(0,l.R7)(),{characters:c}=(0,d.Ib)(),u=t=>"/characters"===t?"/characters"===e||"/characters/"===e||"/"===e:e.startsWith(t);if("/characters"!==e&&"/characters/"!==e&&"/"!==e)return null;let h=[{name:"发现",href:"/characters",icon:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),activeIcon:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10.5 3.75a6.75 6.75 0 100 13.5 6.75 6.75 0 000-13.5zM2.25 10.5a8.25 8.25 0 1114.59 5.28l4.69 4.69a.75.75 0 11-1.06 1.06l-4.69-4.69A8.25 8.25 0 012.25 10.5z",clipRule:"evenodd"})})},{name:"消息",href:"#",onClick:()=>{if(!r)return void document.dispatchEvent(new CustomEvent("open-login-modal",{detail:{tab:"login"}}));if(o&&o.length>0){let e=Math.floor(Math.random()*o.length),r=o[e];t.push("/chat?storyId=".concat(r.id))}else if(c&&c.length>0){let e=Math.floor(Math.random()*c.length),r=c[e];t.push("/chat?characterId=".concat(r.id))}},icon:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),activeIcon:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4.804 21.644A6.707 6.707 0 006 21.75a6.721 6.721 0 003.583-1.029c.774.182 1.584.279 2.417.279 5.322 0 9.75-3.97 9.75-9 0-5.03-4.428-9-9.75-9s-9.75 3.97-9.75 9c0 1.856.56 3.605 1.554 4.893L2.097 21.23a.75.75 0 00.707 1.414z",clipRule:"evenodd"})})},{name:"创建",href:"#",icon:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})}),activeIcon:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 9a.75.75 0 00-1.5 0v2.25H9a.75.75 0 000 1.5h2.25V15a.75.75 0 001.5 0v-2.25H15a.75.75 0 000-1.5h-2.25V9z",clipRule:"evenodd"})})},{name:"设置",href:"/profile",icon:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),activeIcon:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M7.5 6a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM3.751 20.105a8.25 8.25 0 0116.498 0 .75.75 0 01-.437.695A18.683 18.683 0 0112 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 01-.437-.695z",clipRule:"evenodd"})})}];return(0,a.jsx)("div",{className:"fixed bottom-0 left-0 right-0 bg-[var(--bg-primary)] border-t border-[var(--border-color)] z-50 md:hidden",children:(0,a.jsx)("div",{className:"flex items-center justify-around px-4 py-2",children:h.map(e=>{let t="#"!==e.href&&u(e.href);return e.onClick?(0,a.jsxs)("button",{onClick:e.onClick,className:"flex flex-col items-center space-y-1 py-2 px-3 rounded-lg transition-colors ".concat(t?"text-[var(--primary)] bg-[var(--primary)]/10":"text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]"),children:[t?e.activeIcon:e.icon,(0,a.jsx)("span",{className:"text-xs font-medium",children:e.name})]},e.name):(0,a.jsxs)(s(),{href:e.href,className:"flex flex-col items-center space-y-1 py-2 px-3 rounded-lg transition-colors ".concat(t?"text-[var(--primary)] bg-[var(--primary)]/10":"text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]"),children:[t?e.activeIcon:e.icon,(0,a.jsx)("span",{className:"text-xs font-medium",children:e.name})]},e.name)})})})}},1183:(e,t,r)=>{"use strict";r.d(t,{BV:()=>i,E4:()=>n,In:()=>d,J1:()=>s,Kp:()=>l});var a=r(8924);let o=e=>e.invitation,s=(0,a.Mz)([o],e=>e.invitationCode),n=(0,a.Mz)([o],e=>e.commissionRecords),i=(0,a.Mz)([o],e=>e.comprehensiveData),l=(0,a.Mz)([o],e=>e.loading),d=(0,a.Mz)([o],e=>e.error);(0,a.Mz)([l],e=>e.generateCode),(0,a.Mz)([l],e=>e.getComprehensiveData),(0,a.Mz)([l],e=>e.getCommissionRecords),(0,a.Mz)([d],e=>e.generateCode),(0,a.Mz)([d],e=>e.getComprehensiveData),(0,a.Mz)([d],e=>e.getCommissionRecords)},3428:(e,t,r)=>{"use strict";r.d(t,{default:()=>o}),r(5155);var a=r(2115);let o=()=>{let[e,t]=(0,a.useState)(null);return(0,a.useEffect)(()=>{},[]),null}},4373:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,347,23)),Promise.resolve().then(r.t.bind(r,8346,23)),Promise.resolve().then(r.bind(r,229)),Promise.resolve().then(r.bind(r,7694)),Promise.resolve().then(r.bind(r,3428)),Promise.resolve().then(r.bind(r,7280)),Promise.resolve().then(r.bind(r,1002)),Promise.resolve().then(r.bind(r,9743))},5844:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>g,ZC:()=>d,xH:()=>h});var a=r(6439),o=r(9249),s=r(6168),n=r(3299);class i{async getVirtualModels(){try{return(await s.o.models.getVirtualModels()).data}catch(e){throw console.error("Failed to get virtual models:",e),e}}}let l=new(i=(0,o.Cg)([n.A.Singleton],i)),d=(0,a.zD)("model/fetchModels",async()=>(await l.getVirtualModels()).models),c=e=>e.map(e=>({id:e.id,name:e.name,description:e.description||"暂无描述",price:e.pricePerK?"".concat(JSON.stringify(e.pricePerK),"/1K tokens"):"价格待定",isDefault:e.isDefault})),u=(0,a.Z0)({name:"model",initialState:{models:[],uiModels:[],selectedModel:null,status:"idle",error:null},reducers:{setSelectedModel:(e,t)=>{e.selectedModel=t.payload}},extraReducers:e=>{e.addCase(d.pending,e=>{e.status="loading"}).addCase(d.fulfilled,(e,t)=>{if(e.status="succeeded",e.models=t.payload,e.uiModels=c(t.payload),!e.selectedModel&&e.uiModels.length>0){let t=e.uiModels.find(e=>e.isDefault);e.selectedModel=t||e.uiModels[0]}}).addCase(d.rejected,(e,t)=>{e.status="failed",e.error=t.error.message||null})}}),{setSelectedModel:h}=u.actions,g=u.reducer},5939:(e,t,r)=>{"use strict";r.d(t,{$c:()=>i,G0:()=>c,Mw:()=>h,Nh:()=>l,Nq:()=>o,RC:()=>n,po:()=>d,tj:()=>s,xb:()=>u});let a=(0,r(6439).Z0)({name:"story",initialState:{current:null,sidebarOpen:!1},reducers:{setSession(e,t){e.current=t.payload},addMessage(e,t){e.current&&e.current.messages.push(t.payload)},deleteMessage(e,t){e.current&&(e.current.messages=e.current.messages.filter(e=>e.id!==t.payload))},setSending(e,t){e.current&&(e.current.isSending=t.payload)},setError(e,t){e.current&&(e.current.error=t.payload)},setSidebarOpen(e,t){e.sidebarOpen=t.payload},setRegeneratingMessageId(e,t){e.current&&(e.current.regeneratingMessageId=t.payload)},setDeletingMessageId(e,t){e.current&&(e.current.deletingMessageId=t.payload)}}}),{setSession:o,addMessage:s,deleteMessage:n,setSending:i,setError:l,setSidebarOpen:d,setRegeneratingMessageId:c,setDeletingMessageId:u}=a.actions,h=a.reducer},7464:(e,t,r)=>{"use strict";r.d(t,{w1:()=>c,CA:()=>u,kZ:()=>h});var a=r(6439),o=r(9249),s=r(6168),n=r(3299);class i{async generateInvitationCode(e){try{return(await s.o.invitation.generateInvitationCode({generateCodeRequestDto:e})).data}catch(e){throw console.error("Failed to generate invitation code:",e),e}}async getCommissionRecords(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{return(await s.o.invitation.getCommissionRecords({page:e,limit:t,...r})).data}catch(e){throw console.error("Failed to get commission records:",e),e}}async getComprehensiveInviteData(){try{return(await s.o.invitation.getComprehensiveInviteData()).data}catch(e){throw console.error("Failed to get comprehensive invite data:",e),e}}}let l=new(i=(0,o.Cg)([n.A.Singleton],i)),d="invitation",c=(0,a.zD)("".concat(d,"/generateCode"),async(e,t)=>{let{rejectWithValue:r}=t;try{return await l.generateInvitationCode(e.codeData)}catch(e){return r(e instanceof Error?e.message:"Failed to generate invitation code")}}),u=(0,a.zD)("".concat(d,"/getCommissionRecords"),async(e,t)=>{let{rejectWithValue:r}=t;try{let t="object"==typeof e&&(null==e?void 0:e.page)?e.page:1,r="object"==typeof e&&(null==e?void 0:e.limit)?e.limit:10,a={type:"object"==typeof e&&(null==e?void 0:e.type)?e.type:void 0,startDate:"object"==typeof e&&(null==e?void 0:e.startDate)?e.startDate:void 0,endDate:"object"==typeof e&&(null==e?void 0:e.endDate)?e.endDate:void 0};return await l.getCommissionRecords(t,r,a)}catch(e){return r(e instanceof Error?e.message:"Failed to get commission records")}}),h=(0,a.zD)("".concat(d,"/getComprehensiveInviteData"),async(e,t)=>{let{rejectWithValue:r}=t;try{return await l.getComprehensiveInviteData()}catch(e){return r(e instanceof Error?e.message:"Failed to get comprehensive invite data")}})},7817:(e,t,r)=>{"use strict";r.d(t,{d:()=>l});var a=r(2115),o=r(2045),s=r(1183),n=r(7464),i=r(9751);let l=()=>{let e=(0,o.j)(),t=(0,o.G)(s.J1),r=(0,o.G)(s.E4),l=(0,o.G)(s.BV),d=(0,o.G)(s.Kp),c=(0,o.G)(s.In),u=(0,a.useCallback)(t=>e((0,n.w1)(t)),[e]),h=(0,a.useCallback)(t=>{e((0,n.CA)(t))},[e]);return{invitationCode:t,commissionRecords:r,comprehensiveData:l,loading:d,error:c,generateCode:u,fetchCommissionRecords:h,fetchComprehensiveData:(0,a.useCallback)(()=>{e((0,n.kZ)())},[e]),clearError:(0,a.useCallback)(t=>{e((0,i.f3)(t))},[e])}}},8346:e=>{e.exports={style:{fontFamily:"'Inter', 'Inter Fallback'",fontStyle:"normal"},className:"__className_e8ce0c"}},9743:(e,t,r)=>{"use strict";r.d(t,{ReduxProvider:()=>S});var a=r(5155),o=r(2115),s=r(4540),n=r(52),i=r(6439);let l=(0,i.Z0)({name:"app",initialState:{isLoading:!1,error:null,model:{models:[],uiModels:[],selectedModel:null,status:"idle",error:null}},reducers:{setLoading:(e,t)=>{e.isLoading=t.payload},setError:(e,t)=>{e.error=t.payload},clearError:e=>{e.error=null}}}),{setLoading:d,setError:c,clearError:u}=l.actions,h=l.reducer;var g=r(5844);r(6525);let m=(0,n.HY)({app:h,model:g.Ay});var p=r(179);r(3178),r(8613);let v=p.Ay;r(2847),r(3832);var f=r(3525);r(3500),r(298),r(8781);var y=r(8578),C=r(41),w=r(9751);r(7464),r(1183),r(7817),w.uJ,w.f3;let x={key:"user_state",paths:["user.currentUser","user.isAuthenticated","user.settings","user.token"],whitelist:["user/"]},M=(e=>t=>r=>a=>{let o=r(a),s="object"==typeof a&&null!==a&&"type"in a?a.type:"";if(!s||e.whitelist&&e.whitelist.length>0&&!e.whitelist.some(e=>s.startsWith(e))||e.blacklist&&e.blacklist.length>0&&e.blacklist.some(e=>s.startsWith(e)))return o;let n=t.getState(),i={};if(e.paths&&e.paths.length>0&&e.paths.forEach(e=>{let t=e.split("."),r=n;for(let e of t){if(null==r)break;r=r[e]}if(void 0!==r){let e=i;for(let r=0;r<t.length-1;r++){let a=t[r];e[a]||(e[a]={}),e=e[a]}e[t[t.length-1]]=r}}),"user/logout"===s){try{localStorage.removeItem(e.key),"undefined"!=typeof localStorage&&localStorage.removeItem("user.token")}catch(e){console.error("[PersistMiddleware] Error clearing persisted state:",e)}return o}try{localStorage.setItem(e.key,JSON.stringify(i))}catch(e){console.error("[PersistMiddleware] Failed to persist state to localStorage:",e)}return o})(x),k=(0,n.HY)({app:m,user:v,character:f.Ay,chat:y.Ay,story:C.Mw,invitation:w.Ay}),b=function(e){try{let t=localStorage.getItem(e);if(t)return JSON.parse(t)}catch(t){console.error('Failed to load persisted state for key "'.concat(e,'":'),t)}return null}(x.key),j=(0,i.U1)({reducer:k,middleware:e=>e({serializableCheck:!1}).concat([M]),preloadedState:b||void 0});var D=r(6168);let R=(e,t)=>{if(!e)return void console.error("[axios-interceptor] Axios instance is not available in SDKService.");e.interceptors.response.use(e=>e,e=>{var r;return(null==(r=e.response)?void 0:r.status)===401&&(console.warn("[axios-interceptor] Received 401 Unauthorized, dispatching logout."),t.dispatch((0,p.ri)())),Promise.reject(e)}),console.log("[axios-interceptor] Axios interceptor setup complete.")},I=!1,S=e=>{let{children:t}=e,[r,n]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{n(!0),I||(console.log("[StoreProvider] Setting up Axios interceptor..."),R(D.o.getAxiosInstance(),j),I=!0)},[]),(0,a.jsx)(a.Fragment,{children:r?(0,a.jsx)(s.Kq,{store:j,children:t}):(0,a.jsx)(s.Kq,{store:j,children:(0,a.jsx)("div",{style:{visibility:"hidden"},children:t})})})}},9751:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>d,f3:()=>l,uJ:()=>i});var a=r(6439),o=r(7464);let s={invitationCode:null,commissionRecords:null,comprehensiveData:null,loading:{generateCode:!1,getCommissionRecords:!1,getComprehensiveData:!1},error:{generateCode:null,getCommissionRecords:null,getComprehensiveData:null}},n=(0,a.Z0)({name:"invitation",initialState:s,reducers:{clearInvitationState:()=>s,clearInvitationError:(e,t)=>{e.error[t.payload]=null}},extraReducers:e=>{e.addCase(o.w1.pending,e=>{e.loading.generateCode=!0,e.error.generateCode=null}).addCase(o.w1.fulfilled,(e,t)=>{e.loading.generateCode=!1,e.invitationCode=t.payload}).addCase(o.w1.rejected,(e,t)=>{e.loading.generateCode=!1,e.error.generateCode=t.payload||"Unknown error"}),e.addCase(o.CA.pending,e=>{e.loading.getCommissionRecords=!0,e.error.getCommissionRecords=null}).addCase(o.CA.fulfilled,(e,t)=>{e.loading.getCommissionRecords=!1,e.commissionRecords=t.payload}).addCase(o.CA.rejected,(e,t)=>{e.loading.getCommissionRecords=!1,e.error.getCommissionRecords=t.payload||"Unknown error"}),e.addCase(o.kZ.pending,e=>{e.loading.getComprehensiveData=!0,e.error.getComprehensiveData=null}).addCase(o.kZ.fulfilled,(e,t)=>{e.loading.getComprehensiveData=!1,e.comprehensiveData=t.payload}).addCase(o.kZ.rejected,(e,t)=>{e.loading.getComprehensiveData=!1,e.error.getComprehensiveData=t.payload||"Unknown error"})}}),{clearInvitationState:i,clearInvitationError:l}=n.actions,d=n.reducer}},e=>{var t=t=>e(e.s=t);e.O(0,[838,951,320,105,428,116,455,476,613,127,694,441,684,358],()=>t(4373)),_N_E=e.O()}]);