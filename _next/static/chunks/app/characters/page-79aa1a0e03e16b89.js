(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[471],{1876:(e,r,a)=>{Promise.resolve().then(a.bind(a,4699))},4699:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>f});var t=a(5155),s=a(2115),l=a(8663),c=a(6821),i=a(5695),d=a(285),n=a(2045),o=a(1795),u=a(8613),m=a(2847),x=a(5055),g=a(4354),p=a(4421);function b(e){let{activeTab:r,onTabChange:a}=e,s=[{key:"latest",label:"最新",sortBy:p.Qi.createdAt},{key:"daily",label:"日榜",sortBy:p.Qi.popularity},{key:"monthly",label:"月榜"},{key:"favorites",label:"收藏"}];return(0,t.jsx)("div",{className:"flex space-x-4 mb-6 border-b border-border pb-3",children:s.map(e=>(0,t.jsx)("a",{className:"cursor-pointer ".concat(r===e.key?"text-primary font-semibold":"text-muted-foreground hover:text-primary"),onClick:()=>a(e.key,e.sortBy),children:e.label},e.key))})}let h=(e,r)=>{let[a,t]=(0,s.useState)(e);return(0,s.useEffect)(()=>{let a=setTimeout(()=>{t(e)},r);return()=>{clearTimeout(a)}},[e,r]),a};function f(){let e=(0,i.useRouter)(),r=(0,n.j)(),a=(0,n.G)(o.xu),p=(0,n.G)(o.Kc),f=(0,n.G)(e=>e.character.categories),{fetchUserProfile:v}=(0,u.As)(),{characters:j,isLoading:N,error:y,filters:k,pagination:C,categories:_}=(0,m.Ib)(),{currentPage:E,totalPages:w}=C,{searchCharacters:A,setFilter:S}=(0,m.MM)(),{favoriteCharacters:T,isLoading:B,error:G,fetchFavorites:M}=(0,m.Q$)(),[Q,$]=(0,s.useState)(""),[F,O]=(0,s.useState)(""),[z,I]=(0,s.useState)("latest"),K=h(F,500);(0,s.useEffect)(()=>{p||v()},[v,p]),(0,s.useEffect)(()=>{A(),r((0,x.zN)())},[A,k,r]),(0,s.useEffect)(()=>{S({search:K,page:1})},[K,S,A]);let L=(0,s.useCallback)((e,r)=>{I(e),"favorites"===e?(null==a?void 0:a.id)&&M(a.id,1,100):r&&S({sortBy:r,page:1})},[S,null==a?void 0:a.id,M]),P=(0,s.useCallback)(()=>{let e=f.flatMap(e=>e.popularTags);return Array.from(new Set(e.map(e=>e.tag))).map(r=>e.find(e=>e.tag===r)).filter(Boolean)},[f]),R=(0,s.useCallback)(e=>{let r=Q===e?"":e;$(r),S({tags:r?[r]:[],page:1})},[Q,S]),q=r=>{e.push("/character?id=".concat(r))},D=(0,s.useCallback)(()=>{E<w&&S({page:E+1})},[E,w,S]),H=(0,s.useCallback)(()=>{E>1&&S({page:E-1})},[E,S]);return(0,t.jsxs)("main",{className:"min-h-screen bg-background pb-20 md:pb-0",children:[(0,t.jsx)(l.default,{}),(0,t.jsx)("div",{className:"pt-24 pb-16 px-4",children:(0,t.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,t.jsx)(b,{activeTab:z,onTabChange:L}),"favorites"!==z&&(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mb-8",children:P().map(e=>(0,t.jsxs)("span",{className:"cursor-pointer px-3 py-1 rounded-full text-sm ".concat(Q===e.tag?"bg-primary/20 text-primary":"bg-card text-muted-foreground hover:bg-muted hover:text-foreground"),onClick:()=>R(e.tag),children:["#",e.tag]},"tag-".concat(e.tag)))}),(y||G)&&(0,t.jsx)("div",{className:"bg-destructive/20 text-destructive p-4 rounded-md mb-6",children:"favorites"===z?"加载收藏角色时出错: ".concat(G):"加载角色时出错: ".concat(y)}),(N||B)&&(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent text-primary motion-reduce:animate-[spin_1.5s_linear_infinite]",role:"status",children:(0,t.jsx)("span",{className:"sr-only",children:"加载中..."})}),(0,t.jsx)("p",{className:"mt-2 text-muted-foreground",children:"favorites"===z?"正在加载收藏角色...":"正在加载角色..."})]}),"favorites"===z?(0,t.jsxs)(t.Fragment,{children:[!B&&(!T||0===T.length)&&(0,t.jsx)("div",{className:"text-center py-12",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"你还没有收藏任何角色。"})}),!B&&T&&T.length>0&&(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:T.map(e=>(0,t.jsx)(g.A,{character:e,onClick:q},e.id))})]}):(0,t.jsxs)(t.Fragment,{children:[!N&&0===j.length&&(0,t.jsx)("div",{className:"text-center py-12",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"没有找到匹配的角色"})}),!N&&j.length>0&&(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:j.map(e=>(0,t.jsx)(g.A,{character:e,onClick:q},e.id))})]}),"favorites"!==z&&w>1&&(0,t.jsxs)("div",{className:"flex justify-center items-center mt-8 gap-4",children:[(0,t.jsx)(d.$,{variant:"outline",onClick:H,disabled:1===E||N,className:"border-border text-muted-foreground",children:"上一页"}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:[E," / ",w]}),(0,t.jsx)(d.$,{variant:"outline",onClick:D,disabled:E===w||N,className:"border-border text-muted-foreground",children:"下一页"})]})]})}),(0,t.jsx)(c.default,{})]})}}},e=>{var r=r=>e(e.s=r);e.O(0,[951,320,105,428,116,455,476,613,127,663,598,441,684,358],()=>r(1876)),_N_E=e.O()}]);